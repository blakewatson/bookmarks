<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <title>Bookmarks</title>
    <link rel="stylesheet" href="css/pure-nr-min.css" />
    <link rel="stylesheet" href="css/pure-grids-min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <script defer src="js/vue.js"></script>
    <script defer src="js/lunr.js"></script>
    <script defer type="module" src="js/app.js"></script>
  </head>

  <body>
    <div class="container" id="app">
      <b-no-token v-if="!hasToken" @token-added="hasToken = true"></b-no-token>

      <template v-else>
        <b-dashboard class="m-b-xl"></b-dashboard>
      </template>
    </div>

    <!-- COMPONENT TEMPLATES -->

    <!-- Dashboard -->
    <template id="b-dashboard">
      <div>
        <details ref="addBookmarkForm">
          <summary class="pure-button">Add Bookmark</summary>

          <b-bookmark-form
            :selected-tags="selectedTags"
            @bookmark-saved="closeBookmarkForm"
            @cancel="closeBookmarkForm"
          ></b-bookmark-form>
        </details>

        <h1 class="title strong m-t-lg m-b-md">
          <span v-if="!selectedTags.length">All bookmarks</span>
          <span v-else>
            Tag(s):
            <span class="selected-tag" v-for="tag in selectedTags">
              <a @click.prevent="deselectTag(tag)" href="#">{{ tag }}</a>
            </span>
          </span>
        </h1>

        <!-- search control -->
        <b-search class="m-b-lg"></b-search>

        <!-- default dashboard view -->
        <b-bookmarks
          :bookmarks="bookmarks"
          v-if="view === ViewType.home"
        ></b-bookmarks>
      </div>
    </template>

    <!-- Bookmarks list -->
    <template id="b-bookmarks">
      <div class="bookmarks-list">
        <b-bookmark
          :bookmark="bm"
          :key="bm.id"
          class="p-t-md p-b-md"
          v-for="bm in paginatedBookmarks"
        ></b-bookmark>

        <p v-if="!paginatedBookmarks.length">No results.</p>

        <b-pagination
          :total="total"
          v-if="total > 1"
          v-model="page"
        ></b-pagination>
      </div>
    </template>

    <!-- Single bookmark item -->
    <template id="b-bookmark">
      <div class="bookmark-item">
        <template v-if="isEditing">
          <b-bookmark-form
            :key="bookmark.id"
            :bookmark="bookmark"
            @bookmark-saved="isEditing = false"
            @cancel="onCancel"
          ></b-bookmark-form>
        </template>

        <template v-else>
          <article>
            <h2 class="title m-t-none m-b-xs">
              <a :href="bookmark.url">{{ bookmark.title }}</a>
            </h2>

            <p class="m-b-sm m-t-none">
              <a :href="bookmark.url" class="url muted">{{ bookmark.url }}</a>
            </p>

            <div class="description m-b-sm">{{ bookmark.description }}</div>

            <ul class="tags m-none m-t-md m-b-sm">
              <li class="m-r-sm m-t-none m-b-none" v-for="tag in bookmark.tags">
                <a @click.prevent="onClickOfTag(tag)" href="#">{{ tag }}</a>
              </li>
            </ul>

            <div class="bookmark-meta pure-g m-t-md">
              <div class="pure-u p-r-md">
                <time>{{ createdDate }}</time>
              </div>

              <div class="pure-u bookmark-actions">
                <a :href="archiveUrl" class="m-r-sm" v-if="archiveUrl"
                  >cached</a
                >

                <a @click.prevent="onClickOfEdit" class="m-r-sm" href="#"
                  >edit</a
                >

                <a
                  @click.prevent="onClickOfDelete"
                  class="bookmark-delete"
                  href="#"
                  class="bookmark-delete"
                >
                  <span v-if="areYouSure">really?</span>
                  <span v-else>delete</span>
                </a>
                <a @click.prevent="nah" href="#" v-if="areYouSure">nah</a>
              </div>
            </div>
          </article>
        </template>
      </div>
    </template>

    <!-- Bookmark form -->
    <template id="b-bookmark-form">
      <form @submit.prevent="saveBookmark" class="pure-form pure-form-stacked">
        <input
          class="pure-input-1"
          type="text"
          placeholder="Title"
          v-model="title"
        />
        <input
          class="pure-input-1"
          type="url"
          placeholder="URL"
          v-model="url"
        />
        <textarea
          class="pure-input-1"
          rows="3"
          v-model="description"
        ></textarea>
        <input
          class="pure-input-1"
          type="text"
          placeholder="Tags"
          v-model="tags"
        />
        <div class="m-t-md">
          <button class="pure-button pure-button-primary" type="submit">
            Save Bookmark
          </button>

          <button @click="emitCancel" class="pure-button m-l-sm" type="button">
            Cancel
          </button>
        </div>
      </form>
    </template>

    <!-- Search control -->
    <template id="b-search">
      <div class="pure-form">
        <input
          autofocus
          class="pure-input-1 search-input"
          placeholder="Search"
          type="text"
          v-model="search"
        />
      </div>
    </template>

    <!-- Pagination control for lists -->
    <template id="b-pagination">
      <form @submit.prevent class="pagination pure-form m-t-lg m-b-lg">
        <button @click="pagePrevious" class="pure-button m-r-md" type="button">
          Previous
        </button>

        <span>
          <input
            :max="total"
            @keydown.enter="emitInput"
            class="pure-input pagination-input"
            min="1"
            type="number"
            v-model.number="valueLocal"
          />
          of {{ total }}
        </span>

        <button @click="pageNext" class="pure-button m-l-md" type="button">
          Next
        </button>
      </form>
    </template>

    <!-- Login form -->
    <template id="b-no-token">
      <form class="pure-form pure-form-stacked" @submit.prevent="addToken">
        <label>Token</label>
        <input class="pure-input-2-3" type="text" v-model="token" />
        <button class="pure-button pure-button-primary" type="submit">
          Go
        </button>
        <p class="error" v-if="message">{{ message }}</p>
      </form>
    </template>
  </body>
</html>
